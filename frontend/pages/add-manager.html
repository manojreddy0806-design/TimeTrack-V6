<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        window.FontAwesomeConfig = {
            autoReplaceSvg: 'nest'
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous"
        referrerpolicy="no-referrer"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="static/css/style.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            DEFAULT: '#3B82F6',
                            hover: '#2563EB'
                        },
                        secondary: '#64748B',
                        light: '#F8FAFC',
                        'card-border': '#E2E8F0',
                        'input-border': '#CBD5E1'
                    }
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar {
            display: none;
        }

        /* Enhanced input animations */
        .animated-input {
            transform-origin: center;
        }

        .animated-input:focus {
            animation: inputFocus 0.3s ease-out;
        }

        @keyframes inputFocus {
            0% {
                transform: translateY(0) scale(1);
            }

            50% {
                transform: translateY(-2px) scale(1.01);
            }

            100% {
                transform: translateY(-2px) scale(1.02);
            }
        }

        /* Pulse effect on focus */
        .animated-input:focus {
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1), 0 10px 25px -5px rgba(59, 130, 246, 0.2);
        }

        /* Label animation */
        .group label {
            transition: all 0.3s ease-out;
        }

        .group:focus-within label {
            transform: translateX(2px);
        }
        .nav-link-active {
            color: #1d4ed8 !important;
            background-color: rgba(255, 255, 255, 0.95);
            box-shadow: 0 10px 16px rgba(15, 23, 42, 0.18);
        }
        .nav-link-active:hover {
            color: white !important;
            background-color: rgba(59, 130, 246, 0.5) !important;
        }
        /* Mobile Menu Styles */
        .mobile-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 40;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .mobile-menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .mobile-menu {
            position: fixed;
            top: 0;
            right: -100%;
            width: 280px;
            max-width: 85vw;
            height: 100vh;
            background: linear-gradient(to bottom, #2563eb, #1d4ed8);
            z-index: 50;
            transition: right 0.3s ease;
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.3);
            overflow-y: auto;
        }
        .mobile-menu.active {
            right: 0;
        }
        .mobile-menu-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .mobile-menu-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }
        .mobile-menu-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .mobile-menu-nav {
            padding: 1rem 0;
        }
        .mobile-menu-link {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        .mobile-menu-link:hover,
        .mobile-menu-link.active {
            background: rgba(255, 255, 255, 0.15);
            border-left-color: white;
            color: white;
        }
        .mobile-menu-link i {
            margin-right: 0.75rem;
            width: 20px;
            text-align: center;
        }
    </style>
</head>

<body class="bg-light font-sans antialiased text-slate-800">
    <div id="app-container" class="min-h-screen pb-12">
        <header id="header" class="sticky top-0 z-50 w-full">
            <div class="w-[95%] max-w-7xl mx-auto mt-4 bg-gradient-to-r from-blue-600 to-blue-700 backdrop-blur-xl rounded-2xl shadow-2xl border border-blue-400/30">
                <div class="flex items-center justify-between px-10 py-4">
                    <div class="flex items-center space-x-3">
                        <div class="bg-white rounded-xl p-2.5 flex items-center justify-center hover:scale-110 transition-transform duration-200 shadow-lg">
                            <i class="fa-solid fa-clock text-blue-600 text-xl"></i>
                        </div>
                        <span class="text-2xl font-bold text-white">Pramaan</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <nav class="hidden md:flex items-center space-x-3 bg-blue-700/20 px-3 py-2 rounded-xl backdrop-blur-sm">
                            <a href="super-admin.html" data-nav-link class="relative z-10 flex items-center px-6 py-2.5 text-sm font-semibold text-blue-50 hover:text-white hover:bg-blue-400/50 rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-lg transform">
                                <i class="fa-solid fa-chart-pie mr-2"></i>
                                Dashboard
                            </a>
                            <a href="all-managers.html" data-nav-link class="relative z-10 flex items-center px-6 py-2.5 text-sm font-semibold text-blue-50 hover:text-white hover:bg-blue-400/50 rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-lg transform">
                                <i class="fa-solid fa-users mr-2"></i>
                                All Managers
                            </a>
                            <a href="all-admins.html" data-nav-link class="relative z-10 flex items-center px-6 py-2.5 text-sm font-semibold text-blue-50 hover:text-white hover:bg-blue-400/50 rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-lg transform">
                                <i class="fa-solid fa-user-shield mr-2"></i>
                                Admins
                            </a>
                            <a href="#" onclick="showSubscriptionSection(); return false;" class="relative z-10 flex items-center px-6 py-2.5 text-sm font-semibold text-blue-50 hover:text-white hover:bg-blue-400/50 rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-lg transform">
                                <i class="fa-solid fa-credit-card mr-2"></i>
                                Subscription
                            </a>
                        </nav>
                        <button class="hidden md:flex items-center px-6 py-2.5 text-sm font-semibold text-blue-50 hover:text-white hover:bg-blue-400/50 rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-lg transform border border-white/20" onclick="logoutApp()">
                            <i class="fa-solid fa-arrow-right-from-bracket mr-2"></i>
                            Logout
                        </button>
                        <button class="md:hidden text-white hover:text-blue-200 transition-colors duration-200" onclick="toggleMobileMenu()" id="mobileMenuBtn">
                            <i class="fa-solid fa-bars text-xl"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Mobile Menu Overlay -->
        <div class="mobile-menu-overlay" id="mobileMenuOverlay" onclick="closeMobileMenu()"></div>
        
        <!-- Mobile Menu -->
        <div class="mobile-menu" id="mobileMenu">
            <div class="mobile-menu-header">
                <span class="text-white font-bold text-lg">Menu</span>
                <button class="mobile-menu-close" onclick="closeMobileMenu()">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
            <nav class="mobile-menu-nav">
                <a href="super-admin.html" class="mobile-menu-link" onclick="closeMobileMenu()">
                    <i class="fa-solid fa-chart-pie"></i>
                    Dashboard
                </a>
                <a href="all-managers.html" class="mobile-menu-link" onclick="closeMobileMenu()">
                    <i class="fa-solid fa-users"></i>
                    All Managers
                </a>
                <a href="all-admins.html" class="mobile-menu-link" onclick="closeMobileMenu()">
                    <i class="fa-solid fa-user-shield"></i>
                    Admins
                </a>
                <a href="#" class="mobile-menu-link" onclick="showSubscriptionSection(); closeMobileMenu(); return false;">
                    <i class="fa-solid fa-credit-card"></i>
                    Subscription
                </a>
                <div class="border-t border-white/20 my-2"></div>
                <button class="mobile-menu-link w-full text-left" onclick="logoutApp(); closeMobileMenu();" style="border: none; background: none; cursor: pointer;">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                    Logout
                </button>
            </nav>
        </div>

        <main id="main-content" class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 pt-32 pb-16">
            <div id="page-header" class="mb-10 mt-8">
                <div class="flex items-center space-x-5">
                    <div class="bg-gradient-to-br from-blue-600 to-blue-700 p-4 rounded-2xl shadow-lg">
                        <i class="fa-solid fa-user-tie text-white text-3xl"></i>
                    </div>
                    <div class="flex-1">
                        <h1 id="pageTitle" class="text-4xl font-bold text-slate-900 mb-2">Add New Manager</h1>
                        <p class="text-base text-slate-600">Create a new manager account with secure credentials</p>
                    </div>
                </div>
            </div>

            <div id="error-box" class="mb-6 bg-red-50 border-l-4 border-red-500 rounded-xl p-5 hidden shadow-md">
                <div class="flex items-start space-x-4">
                    <div class="bg-red-100 p-3 rounded-xl">
                        <i class="fa-solid fa-triangle-exclamation text-red-600 text-xl"></i>
                    </div>
                    <div class="flex-1">
                        <div class="font-bold text-red-900 text-base mb-1.5">Error Occurred</div>
                        <div id="error-message" class="text-red-700 text-sm leading-relaxed"></div>
                    </div>
                </div>
            </div>

            <div id="status-message" class="mb-6 p-4 rounded-xl hidden text-center font-semibold text-sm shadow-md">
            </div>

            <div id="manager-form-card"
                class="bg-white p-10 rounded-2xl border border-slate-200 shadow-xl hover:shadow-2xl transition-all duration-300">
                <div class="flex items-center mb-8 pb-6 border-b-2 border-slate-100">
                    <div class="bg-blue-50 p-3 rounded-xl hover:bg-blue-100 transition-colors duration-200">
                        <i class="fa-solid fa-user-shield text-blue-600 text-2xl"></i>
                    </div>
                    <h2 class="ml-4 text-2xl font-bold text-slate-900">Manager Information</h2>
                </div>

                <form id="add-manager-form" class="space-y-6">
                    <div class="group">
                        <label for="manager-name"
                            class="block text-sm font-bold text-slate-800 mb-2.5 group-focus-within:text-blue-600 transition-colors duration-200">
                            Manager Name <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="manager-name" name="manager-name" placeholder="Enter full name" required
                            class="animated-input block w-full px-5 py-3.5 text-base bg-slate-50 border-2 border-slate-300 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-600 focus:bg-white focus:shadow-lg focus:-translate-y-0.5 focus:scale-[1.02] transition-all duration-300 ease-out placeholder:text-slate-400 hover:border-slate-400 hover:shadow-sm">
                    </div>

                    <div class="group">
                        <label for="manager-username"
                            class="block text-sm font-bold text-slate-800 mb-2.5 group-focus-within:text-blue-600 transition-colors duration-200">
                            Username <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="manager-username" name="manager-username"
                            placeholder="Choose a unique username" required
                            class="animated-input block w-full px-5 py-3.5 text-base bg-slate-50 border-2 border-slate-300 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-600 focus:bg-white focus:shadow-lg focus:-translate-y-0.5 focus:scale-[1.02] transition-all duration-300 ease-out placeholder:text-slate-400 hover:border-slate-400 hover:shadow-sm">
                    </div>

                    <div class="group">
                        <label for="manager-password"
                            class="block text-sm font-bold text-slate-800 mb-2.5 group-focus-within:text-blue-600 transition-colors duration-200">
                            Password <span class="text-red-500">*</span>
                        </label>
                        <input type="password" id="manager-password" name="manager-password"
                            placeholder="Create a strong password" required
                            class="animated-input block w-full px-5 py-3.5 text-base bg-slate-50 border-2 border-slate-300 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-600 focus:bg-white focus:shadow-lg focus:-translate-y-0.5 focus:scale-[1.02] transition-all duration-300 ease-out placeholder:text-slate-400 hover:border-slate-400 hover:shadow-sm">
                    </div>

                    <div class="group">
                        <label for="manager-confirm-password"
                            class="block text-sm font-bold text-slate-800 mb-2.5 group-focus-within:text-blue-600 transition-colors duration-200">
                            Confirm Password <span class="text-red-500">*</span>
                        </label>
                        <input type="password" id="manager-confirm-password" name="manager-confirm-password"
                            placeholder="Re-enter password" required
                            class="animated-input block w-full px-5 py-3.5 text-base bg-slate-50 border-2 border-slate-300 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-600 focus:bg-white focus:shadow-lg focus:-translate-y-0.5 focus:scale-[1.02] transition-all duration-300 ease-out placeholder:text-slate-400 hover:border-slate-400 hover:shadow-sm">
                        <div id="confirm-password-error" class="mt-2 text-sm text-red-600 hidden"></div>
                    </div>

                    <div class="flex items-center space-x-4 pt-8">
                        <button type="submit" id="submit-btn"
                            class="flex-1 flex items-center justify-center px-8 py-4 text-base font-bold text-white bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl hover:from-blue-700 hover:to-blue-800 hover:shadow-xl hover:scale-[1.03] active:scale-[0.98] transition-all duration-200 shadow-lg">
                            <i class="fa-solid fa-check mr-3 text-lg"></i>
                            Add Manager
                        </button>
                        <button type="button" onclick="window.location='super-admin.html'"
                            class="px-8 py-4 text-base font-bold text-slate-700 bg-white border-2 border-slate-300 rounded-xl hover:bg-slate-50 hover:border-slate-400 hover:shadow-lg hover:scale-[1.03] active:scale-[0.98] transition-all duration-200">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <script src="static/js/script.js"></script>
    <script>
        // Add enhanced focus animations to all inputs
        document.addEventListener('DOMContentLoaded', function () {
            const inputs = document.querySelectorAll('.animated-input');

            inputs.forEach(input => {
                // Add focus event listener for extra animation
                input.addEventListener('focus', function () {
                    this.parentElement.classList.add('input-focused');
                    // Add a subtle pulse effect
                    this.style.animation = 'inputFocus 0.3s ease-out';
                });

                input.addEventListener('blur', function () {
                    this.parentElement.classList.remove('input-focused');
                });

                // Add click animation
                input.addEventListener('mousedown', function () {
                    this.style.transform = 'translateY(-1px) scale(1.01)';
                });

                input.addEventListener('mouseup', function () {
                    this.style.transform = '';
                });
            });

            // Real-time password validation
            const passwordInput = document.getElementById('manager-password');
            const confirmPasswordInput = document.getElementById('manager-confirm-password');
            const errorDiv = document.getElementById('confirm-password-error');

            function validatePasswords() {
                const password = passwordInput.value;
                const confirmPassword = confirmPasswordInput.value;
                
                if (confirmPassword && password && password !== confirmPassword) {
                    errorDiv.textContent = 'Passwords do not match';
                    errorDiv.classList.remove('hidden');
                    confirmPasswordInput.classList.add('border-red-500');
                } else {
                    errorDiv.classList.add('hidden');
                    confirmPasswordInput.classList.remove('border-red-500');
                }
            }

            if (passwordInput && confirmPasswordInput && errorDiv) {
                passwordInput.addEventListener('input', validatePasswords);
                confirmPasswordInput.addEventListener('input', validatePasswords);
            }
        });

        let isEditMode = false;
        let editUsername = null;

        const urlParams = new URLSearchParams(window.location.search);
        const editParam = urlParams.get('edit');

        if (editParam) {
            isEditMode = true;
            editUsername = editParam;
            document.getElementById('pageTitle').textContent = 'Edit Manager';
            document.getElementById('submit-btn').innerHTML = '<i class="fa-solid fa-check mr-2"></i> Update Manager';
            document.getElementById('manager-username').disabled = true;
            document.getElementById('manager-password').required = false;
            document.getElementById('manager-confirm-password').required = false;
            document.getElementById('manager-password').placeholder = 'Leave empty to keep current password';
            document.getElementById('manager-confirm-password').placeholder = 'Leave empty to keep current password';

            loadManagerData(editUsername);
        }

        async function loadManagerData(username) {
            try {
                const manager = await apiGet(`/managers/${username}`);
                document.getElementById('manager-name').value = manager.name || '';
                document.getElementById('manager-username').value = manager.username || '';
            } catch (err) {
                showStatus('Failed to load manager data: ' + err.message, 'error');
            }
        }

        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status-message');
            statusEl.textContent = message;
            statusEl.className = 'mb-6 p-4 rounded-xl text-center font-semibold text-sm shadow-md';

            if (type === 'error') {
                statusEl.classList.add('bg-red-100', 'text-red-800', 'border', 'border-red-300');
            } else if (type === 'success') {
                statusEl.classList.add('bg-green-100', 'text-green-800', 'border', 'border-green-300');
            } else {
                statusEl.classList.add('bg-blue-100', 'text-blue-800', 'border', 'border-blue-300');
            }

            statusEl.classList.remove('hidden');

            if (type !== 'error') {
                setTimeout(() => {
                    statusEl.classList.add('hidden');
                }, 5000);
            }
        }

        document.getElementById('add-manager-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const managerName = document.getElementById('manager-name').value.trim();
            const managerUsername = document.getElementById('manager-username').value.trim();
            const managerPassword = document.getElementById('manager-password').value;
            const managerConfirmPassword = document.getElementById('manager-confirm-password').value;

            document.getElementById('error-box').classList.add('hidden');
            // Clear inline password error
            document.getElementById('confirm-password-error').classList.add('hidden');
            document.getElementById('manager-confirm-password').classList.remove('border-red-500');

            if (!managerName) {
                showStatus('Please enter manager name', 'error');
                return;
            }

            if (!managerUsername) {
                showStatus('Please enter username', 'error');
                return;
            }

            if (!isEditMode && !managerPassword) {
                showStatus('Please enter password', 'error');
                return;
            }

            if (managerPassword && managerPassword !== managerConfirmPassword) {
                const errorDiv = document.getElementById('confirm-password-error');
                errorDiv.textContent = 'Passwords do not match';
                errorDiv.classList.remove('hidden');
                document.getElementById('manager-confirm-password').classList.add('border-red-500');
                // Scroll to error
                document.getElementById('manager-confirm-password').scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            } else {
                // Clear error if passwords match
                document.getElementById('confirm-password-error').classList.add('hidden');
                document.getElementById('manager-confirm-password').classList.remove('border-red-500');
            }

            try {
                if (isEditMode) {
                    showStatus('Updating manager...', 'info');

                    const updateData = {
                        name: managerName
                    };

                    if (managerPassword) {
                        updateData.password = managerPassword;
                    }

                    await apiPut(`/managers/${editUsername}`, updateData);
                    showStatus('Manager updated successfully!', 'success');
                } else {
                    showStatus('Creating manager...', 'info');

                    await apiPost('/managers/', {
                        name: managerName,
                        username: managerUsername,
                        password: managerPassword
                    });

                    showStatus('Manager added successfully!', 'success');
                }

                setTimeout(() => {
                    window.location = 'super-admin.html';
                }, 2000);

            } catch (err) {
                console.error('Failed to save manager:', err);

                // Hide error box if it was shown
                document.getElementById('error-box').classList.add('hidden');

                // Extract error message
                const errorMessage = err.message || err.error || 'Failed to save manager';
                
                // Show error as toast notification
                if (typeof showToast === 'function') {
                    showToast(errorMessage, 'error', 'Error');
                } else {
                    // Fallback if showToast is not available
                    console.error('showToast function not available');
                    alert(errorMessage);
                }
            }
        });
        
        // Mobile Menu Functions
        function toggleMobileMenu() {
            const overlay = document.getElementById('mobileMenuOverlay');
            const menu = document.getElementById('mobileMenu');
            overlay.classList.toggle('active');
            menu.classList.toggle('active');
            if (menu.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }
        
        function closeMobileMenu() {
            const overlay = document.getElementById('mobileMenuOverlay');
            const menu = document.getElementById('mobileMenu');
            overlay.classList.remove('active');
            menu.classList.remove('active');
            document.body.style.overflow = '';
        }
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeMobileMenu();
            }
        });
        
        function updateMobileMenuActiveState() {
            const currentPath = window.location.pathname.split('/').pop() || 'add-manager.html';
            const mobileLinks = document.querySelectorAll('.mobile-menu-link');
            mobileLinks.forEach(link => {
                link.classList.remove('active');
                const href = link.getAttribute('href');
                if (href && href !== '#') {
                    const hrefPath = href.split('/').pop().split('#')[0];
                    if (hrefPath === currentPath) {
                        link.classList.add('active');
                    }
                }
            });
        }
        
        function showSubscriptionSection() {
            window.location.href = 'super-admin.html#subscription';
        }
        
        // Initialize navigation active state
        function initNavActiveState() {
            const nav = document.querySelector('nav');
            if (nav) {
                const links = Array.from(nav.querySelectorAll('a[data-nav-link]'));
                links.forEach(link => link.classList.remove('nav-link-active'));
                
                const currentPath = window.location.pathname.split('/').pop() || 'add-manager.html';
                const activeLink = links.find(link => {
                    const href = link.getAttribute('href');
                    const hrefPath = href.split('/').pop();
                    return hrefPath === currentPath;
                });
                
                if (activeLink) {
                    activeLink.classList.add('nav-link-active');
                }
            }
        }
        
        initNavActiveState();
        updateMobileMenuActiveState();
    </script>

</body>

</html>